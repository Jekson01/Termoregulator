<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Терморегулятор</title>
  <link rel="stylesheet" href="style.css">
  <link href="bootstrap.css" rel="stylesheet">
  <script src="jquery.js"></script>
  <script>
  $(document).ready(function() {
    (function update() {
      $.getJSON('ajax/temperatura', function(data) {
        $('#tsensor').text((data.sensor['temperatura'] / 10).toFixed(1));
        var mode = data.sensor['mode'];


        if (mode) {
          $("#mode").text("Режим нагрева.");
        } else {
          $("#mode").text("Режим охлаждения.");
        }

        var state = data.sensor['state'];
        if (state) {
          $("#ssensor").css('color', 'red');
          $("#ssensor").text("Включено.");
        } else {
          $("#ssensor").css('color', 'blue');
          $("#ssensor").text("Выключено.");
        }



      })
      setTimeout(update, 2000);
    })()

    var tOn;
    var tOff;

    function printValues() {
      $("#ton").val((tOn / 10).toFixed(1));
      $("#toff").val((tOff / 10).toFixed(1));
    }

    function load() {
      $.getJSON("ajax/getparams", function(data) {
        tOn = data.param["ton"];
        tOff = data.param["toff"];
        printValues();
      })
    }

    load();

    $("#save-btn").click(function() {

      tOn = $("#ton").val() * 10;
      tOff = $("#toff").val() * 10;

      $.getJSON('ajax/setparams', { ton: tOn, toff: tOff }, function(data) {
        load();
      })
    })

    $("#update-btn").click(function(){
      load();
    })


  })
  </script>
</head>

<body>
  <nav class="navbar navbar-inverse">
    <div class="container-fluid">
      <ul class="nav navbar-nav navbar-left">
        <li><a href="index.html">Главная</a></li>
        <li><a href="wifisettings.html">Настройка Wifi</a></li>
      </ul>
    </div>
  </nav>
  <div class="row ">
    <div class="col-lg-7 panel panel-primary text-center container">
      <div class="panel-heading ">
        <h3 class="panel-title">Текущая температура</h3>
      </div>
      <div class="panel-body">
        <p id="tsensor" class="temperatura h1 text-info">NaN</p>
        <p id="ssensor" class="state h3 text-info">NaN</p>
        <p id="mode" class="h3 text-info">NaN</p>
      </div>
    </div>

    <div class="col-lg-5">
      <div class="form-horizontal container">
        <fieldset>
          <legend>Параметры</legend>
          <div class="form-group">
            <label for="toff" class="col-lg-3 control-label">Температура включения</label>
            <div class="col-lg-2">
              <input class="form-control" id="toff" placeholder="0.0" type="text">
            </div>
          </div>
          <div class="form-group">
            <label for="ton" class="col-lg-3 control-label">Температура выключения</label>
            <div class="col-lg-2">
              <input class="form-control" id="ton" placeholder="0.0" type="text">
            </div>
          </div>
          <div class="form-group">
            <div class="col-lg-5">
              <button type="button" id="update-btn" class="btn btn-default">Обновить</button>
              <button type="button" id="save-btn" class="btn btn-primary">Сохранить</button>
            </div>
          </div>
        </fieldset>
      </div>
    </div>
  </div>
</body>

</html>